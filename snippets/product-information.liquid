{{- 'product.css' | asset_url | stylesheet_tag -}}
<script src="{{ 'product.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'tab-switching.js' | asset_url }}" defer="defer"></script>
<div
  id="ProductInfo-{{ section.id }}"
  class="product-information--inner{% if section.settings.enable_sticky_info %} production-information--sticky{% endif %}"
>
  {%- assign product_form_id = 'product-form-' | append: section.id -%}
  {% for block in section.blocks %}
    {%- case block.type -%}
      {%- when '@app' -%}
        {% render block %}
      {%- when 'text' -%}
        <p class="product--text {{ block.settings.text_style }}" {{ block.shopify_attributes }}>
          {{- block.settings.text -}}
        </p>
      {%- when 'custom_liquid' -%}
        {{ block.settings.custom_liquid }}
      {%- when 'title' -%}
        <div class="product-title-container" {{ block.shopify_attributes }}>
          <h1 class="product-title uppercase--{{ block.settings.uppercase }}">
            {% assign title_words = product.title | split: '|' %}
            <span class="product-tittle-first_word">{{ title_words[0] }}</span>
            <p class="product-tittle-reamaining_words">
              {% for i in (1..title_words.size) %}
                {{ title_words[i] }}
              {% endfor %}
            </p>
          </h1>
          <div class="product-price-container">
            <div class="no-js-hidden" id="price-{{ section.id }}">
              {% render 'product-price', product: product, use_variant: true, show_badges: true %}
            </div>
          </div>
          {%- if block.settings.show_products_rating and product.metafields.reviews.rating.value != blank -%}
            <a class="star-rating-container" href="#shopify-product-reviews">
              <div
                class="star-rating"
                style="--star-rating: {{ product.metafields.reviews.rating.value.rating }};"
              ></div>
              <span>{{ 'products.product.reviews' | t: count: product.metafields.reviews.rating_count }}</span>
            </a>
          {%- endif -%}
        </div>
      {%- when 'description' -%}
        <div class="product-short-description rte" {{ block.shopify_attributes }}>{{ product.description }}</div>
        {% if product.metafields.custom.product_details != blank %}
          <div class="product-details-card">
            <div id="content">
              {% for key_value_pair in product.metafields.custom.product_details.value %}
                <p class="fist-value">{{ key_value_pair | first }}</p>
                <p>:</p>
                <p class="last-value">{{ key_value_pair | last }}</p>
              {% endfor %}
            </div>
          </div>
          <button id="viewMoreBtn">View More</button>
        {% endif %}
        {% render 'pincode-checker' %}
      {%- when 'inventory_level' -%}
        {% render 'product-inventory-notice', product: product, section: section, block: block %}
      {%- when 'variant_picker' -%}
        {%- unless product.has_only_default_variant -%}
          {%- liquid
            assign is_disabled = block.settings.variant_is_disabled
            assign picker_type = 'dropdown'
            assign color_picker = true
          -%}
          <variant-selects
            id="variant-selects-{{ section.id }}"
            class="no-js-hidden"
            data-update-url="{{ update_url }}"
            data-section="{{ section.id }}"
            data-url="{{ product.url }}"
            data-size="{{ product.option }}"
            data-is-disabled="{{ is_disabled }}"
          >
                 {% if product.metafields.custom.fabric_image != blank %}
                <div class="variant-heading">Colour</div>
                <div class="related-products__container" data-current-product="{{ product.handle }}">
                  {% assign variantProduct = product.metafields.custom.fabric_image.value %}
                  <div class="variant_as-product">
                    {% assign imageCount = variantProduct | size %}
                    {% for VariantImage in variantProduct %}
                      <span class="related-image">
                        <img class="related-image" src="{{ VariantImage}}" alt="image">
                      </span>
                    {% endfor %}
                    <span class="variant-count"> {{ imageCount }} Colours </span>
                  </div>
                </div>
              {% endif %}

              <div class="popup" id="customPopup">
                 <div class="frequent-product_card ">
                      {%- assign related_products = '' -%}
                      {% for tag in product.tags %}
                        {% if tag contains 'related-' %}
                        {%- assign product_handle = tag | remove: 'related-' -%}
                        {%- assign related_products = related_products | append: ',' | append: product_handle -%}
                      {% endif %} 
                      {% endfor %} 
                      {%- assign related_products = related_products | remove_first: ',' | split: ',' -%}
                      {% if related_products.size > 0 %}
                        <div class="product-frequent-count">
                          <div class="cbb-frequent-product">
                            {%  assign product = '' %}
                            {%- assign product_variant_ids = '' -%}
                            {% for product_handle in related_products %}
                              {%- assign product = all_products[product_handle] -%}
                              {%- assign product_variant_ids = product_variant_ids 
                                | append: product.selected_or_first_available_variant.id
                                | append: ', ' -%}
                              <div class="cbb-frequent-item">
                                <a class="cbb-frequently-bought" href="{{ product.url }}">
                                  <img class="lg:tw-h-[295px]" src="{{product.featured_image.src | img_url: 'medium'  }}">
                                </a>
                              </div>
                            {% endfor %}
                          </div>
                        </div>
                        {% endif %}
                      </div>
            {%- assign product_variant_ids = product_variant_ids | split: ', ' | join: ', ' %}
             <product-form class="lg:tw-flex">
               <form class="form product-form">
                 <input
                   type="hidden"
                   name="id"
                   value="{{ card_product.selected_or_first_available_variant.id }}"
                   disabled
                 >
                 <input
                   type="hidden"
                   name="add-ons"
                   value="{{ product_variant_ids }}"
                   disabled
                 >
                 <button
                   id="{{ product_form_id }}-submit"
                   type="submit"
                   name="add"
                   class="quick-add__submit button tw-mb-[40px] tw-mt-[33px] lg:tw-my-[0px] tw-bg-[#54555A;] {% if horizontal_quick_add %} card--horizontal__quick-add{% endif %}"
                   aria-haspopup="dialog"
                   aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                   aria-live="polite"
                   data-sold-out-message="true"
                   {% if card_product.selected_or_first_available_variant.available == false %}
                     disabled
                   {% endif %}
                 >
                   <span>
                       {{ 'products.product.add_to_cart' | t }}
                   </span>
                   <span class="sold-out-message hidden">
                     {{ 'products.product.sold_out' | t }}
                   </span>
                   {%- if horizontal_quick_add -%}
                     <span class="icon-wrap">{% render 'icon-plus' %}</span>
                   {%- endif -%}
                   <div class="loading-overlay__spinner hidden">
                     <svg
                       aria-hidden="true"
                       focusable="false"
                       class="spinner"
                       viewBox="0 0 66 66"
                       xmlns="http://www.w3.org/2000/svg"
                     >
                       <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                     </svg>
                   </div>
                 </button>
                 </form> 
               </product-form>
                     <button class="cross-icon" onclick="closePopup()">{% render 'svg-icons' with 'close' %}</button>
              </div>
            <div class="variations" {{ block.shopify_attributes }}>
              {%- for option in product.options_with_values -%}
                {%- liquid
                  assign option_name = option.name | downcase | escape
                  assign option_type = block.settings.picker_type
                  assign picker_type = option_type
                  assign color_picker_size = block.settings.color_picker_size | default: 'regular'
                  assign color_picker_use_variants = block.settings.color_picker_use_variants
                  if block.settings.color_picker
                    if option_name contains 'color' or option_name contains 'colour' or option_name contains 'couleur' or option_name contains 'farbe'
                      assign option_type = 'color'
                    endif
                  endif
                  unless block.settings.color_picker
                    assign color_picker = false
                  endunless
                -%}
                {%- liquid
                  assign option_slug = option.name | downcase
                  assign sizing_link = ''
                -%}
                {%- if option_slug == 'size' -%}
                  {%- if block.settings.sizing_guide_text != '' -%}
                    {%- capture sizing_link -%}
                   <modal-opener class="product-popup-modal__opener no-js-hidden" data-modal="#PopupModal-{{ block.id }}">
                      <button id="ProductPopup-{{ block.id }}" class="product-popup-modal__button" type="button" aria-haspopup="dialog">
                      {% render 'svg-icons-inline', icon: block.settings.sizing_guide_icon %}<span>{{ block.settings.sizing_guide_text }}</span></button>
                   </modal-opener>
                   {%- endcapture -%}
                    {%- capture sizing_popup -%}
                   <modal-dialog id="PopupModal-{{ block.id }}" class="product-popup-modal">
                      <div role="dialog" aria-label="{{ block.settings.sizing_guide_text }}" aria-modal="true" class="product-popup-modal__content" tabindex="-1">
                         <div class="product-popup-modal__content-header">
                            <h5>{{ block.settings.sizing_guide_page.title }}</h5>
                            <button id="ModalClose-{{ block.id }}" type="button" class="product-popup-modal__toggle" aria-label="{{ 'accessibility.close' | t }}">{% render 'svg-icons' with 'close' %}</button>
                         </div>
                         <div class="product-popup-modal__content-info">
                        <tab-switch>
                          <div class="size-chart-container">
                            <div class="size-chart-wrapper">
                              {% assign sizeChartData = product.metafields.custom.size_chart.value %}
                              {% for sizechartheading in sizeChartData %}
                                <div class="tab--heading{% if forloop.first %} is--active{% endif %}" data-tab="{{ sizechartheading.id | handleize }}">
                                  {{ sizechartheading.id | replace: '_', ' '}}
                                </div>
                              {% endfor %}
                            </div>
                            {% assign sizeChartData = product.metafields.custom.size_chart.value %}
                            {% for chart in sizeChartData %}
                              <div id="{{ chart.id | handleize }}" class="tab-content container-content{% if forloop.first %} active_content{% endif %}">
                                <div class="sizechart-tab-contents">
                                  <div class="tab-content-description">
                                    <table>
                                      {% assign sizeinfo = chart.sizeChartInfo %}
                                      <tr class="size-chart-card">
                                      <td>SIZE</td>
                                      {% for item in sizeinfo %}
                                        {% assign sizevalues = item.info %}
                                        {% for sizes in sizevalues %}
                                          <td>{{ sizes | first }}</td>
                                        {% endfor %}
                                        {% break %}
                                      {% endfor %}
                                      </tr>
                                      {% for item in sizeinfo %}
                                        {% assign bustvalues = item.info %}
                                        <tr class="bust-size-values">
                                         <td class='size-values'>{{ item.size }}</td>
                                          {% for bustsize in bustvalues %}
                                            <td>{{ bustsize | last }}</td>
                                          {% endfor %}
                                        </tr>
                                      {% endfor %}
                                    </table>
                                  </div>
                                  <div class="sizeChart_text">
                                    {{ settings.size_chart_text }}
                                  </div>
                                  <div>
                                   {% if chart.id == "body_measurement" %}
                                      {% render 'responsive-picture', 
                                        desktopImage: settings.body_measurement,
                                        mobileImage: settings.body_measurement_mobile,
                                        loading: lazy_load
                                      %}
                                  {% elsif chart.id == "garment_measurement" %}
                                      {% render 'responsive-picture', 
                                        desktopImage: settings.garment_measurement,
                                        mobileImage: settings.garment_measurement,
                                        loading: lazy_load
                                      %}
                                  {% endif %}
                                  </div>
                                </div>
                              </div>
                            {% endfor %}
                          </div>
                        </tab-switch>
                     </div>
                  </div>
               </modal-dialog>
               {%- endcapture -%}
                  {%- endif -%}
                {%- endif -%}
                {% render 'product-option',
                  option_type: option_type,
                  color_picker_size: color_picker_size,
                  color_picker_use_variants: color_picker_use_variants,
                  product: product,
                  option: option,
                  forloop: forloop,
                  product_form_id: product_form_id,
                  sizing_link: sizing_link
                %}
              {%- endfor -%}
            </div>
            <script type="application/json">
              {{ product.variants | json }}
            </script>
          </variant-selects>
        {%- endunless -%}
        <noscript class="product-form__noscript-wrapper-{{ section.id }}">
          <div class="product-form__input{% if product.has_only_default_variant %} hidden{% endif %}">
            <label for="Variants-{{ section.id }}">{{ 'products.product.product_variants' | t }}</label>
            <div class="select">
              <select name="id" id="Variants-{{ section.id }}" class="select__select" form="{{ product_form_id }}">
                {%- for variant in product.variants -%}
                  <option
                    {% if variant == product.selected_or_first_available_variant %}
                      selected="selected"
                    {% endif %}
                    {% if variant.available == false %}
                      disabled
                    {% endif %}
                    value="{{ variant.id }}"
                  >
                    {{ variant.title }}
                    {%- if variant.available == false %} - {{ 'products.product.sold_out' | t }}{% endif %}
                    - {{ variant.price | money | strip_html -}}
                  </option>
                {%- endfor -%}
              </select>
            </div>
          </div>
        </noscript>
      {%- when 'side_panel' -%}
        <div class="side-panel-links">
          {%- if block.settings.side_panel_1_label != '' -%}
            <button class="side-panel-links--link ">
              {% render 'svg-icons-inline', icon: block.settings.side_panel_1_icon -%}
              <div class="text_button">{{ block.settings.side_panel_1_label }}</div>
            </button>
          {%- endif -%}
          {%- if block.settings.side_panel_2_label != '' -%}
            <button class="side-panel-links--link no-js-hidden">
              {% render 'svg-icons-inline', icon: block.settings.side_panel_2_icon -%}
              <div class="text_button">{{ block.settings.side_panel_2_label }}</div>
            </button>
          {%- endif -%}
          {%- if block.settings.side_panel_3_label != '' -%}
            <button class="side-panel-links--link no-js-hidden">
              {% render 'svg-icons-inline', icon: block.settings.side_panel_3_icon -%}
              <div class="text_button">{{ block.settings.side_panel_3_label }}</div>
            </button>
          {%- endif -%}
        </div>
      {%- when 'buy_buttons' -%}
        {% render 'product-add-to-cart',
          product: product,
          form: form,
          product_form_id: product_form_id,
          block: block,
          pickup: pickup
        %}
      {%- when 'collapsible_tab' -%}
        <collapsible-row class="product__accordion accordion" {{ block.shopify_attributes }}>
          <details
            id="Details-{{ block.id }}-{{ section.id }}"
            {% if block.settings.open %}
              open
            {% endif %}
          >
            <summary>
              {{ block.settings.heading | default: block.settings.page.title }}
              <span></span>
            </summary>
            <div
              class="collapsible__content accordion__content rte"
              id="ProductAccordion-{{ block.id }}-{{ section.id }}"
            >
              {{ block.settings.content }}
              {{ block.settings.page.content }}
              {{ block.settings.custom_liquid }}
            </div>
          </details>
        </collapsible-row>
      {%- when 'complementary' -%}
        <product-recommendations
          class="complementary-products no-js-hidden"
          data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit={{ block.settings.product_list_limit }}&intent=complementary"
        >
          {%- if recommendations.performed and recommendations.products_count > 0 -%}
            <div class="complementary-products--inner">
              {%- if block.settings.block_heading != blank -%}
                <div class="complementary-products--heading">{{ block.settings.block_heading }}</div>
              {%- endif -%}
              {%- for recommended_product in recommendations.products
                limit: block.settings.product_list_limit
                offset: continue
              -%}
                {%- render 'product-card-small', product_small: recommended_product, quick_add: true -%}
              {%- endfor -%}
            </div>
            <script src="{{ 'product-recommendations.js' | asset_url }}" defer="defer"></script>
          {%- endif -%}
        </product-recommendations>
      {%- when 'image' -%}
        <div class="product-information--image {{ block.settings.position }}" {{ block.shopify_attributes }}>
          {% if block.settings.image %}
            {%- liquid
              assign image = block.settings.image
              assign sizes = image.src.width | append: 'x' | append: image.src.height
              render 'responsive-image', image: image, sizes: sizes
            -%}
          {%- else -%}
            <div class="thb-placeholder">
              {{ 'image' | placeholder_svg_tag: 'placeholder_svg_tag' }}
            </div>
          {%- endif -%}
        </div>
      {% when 'custom_option' %}
        {%- if block.settings.label != blank -%}
          {%- liquid
            assign line_item_input_id = product_form_id | append: '-custom-' | append: forloop.index
            assign line_item_input_name = block.settings.label | escape | prepend: 'properties[' | append: ']'
            assign required = block.settings.text_required
            assign text_placeholder = block.settings.text_placeholder
          -%}
          <fieldset class="product-form__input product-information--line-item" {{ block.shopify_attributes }}>
            <div class="form__label" for="{{ line_item_input_id }}">{{ block.settings.label | escape }}</div>
            {% case block.settings.type %}
              {% when 'text' %}
                <input
                  class="product-information--line-item--text"
                  type="text"
                  id="{{ line_item_input_id }}"
                  form="{{ product_form_id }}"
                  name="{{ line_item_input_name }}"
                  placeholder="{{ text_placeholder }}"
                  form="{{ product_form_id }}"
                  {% if required %}
                    required
                  {% endif %}
                >
              {% when 'textarea' %}
                <textarea
                  class="product-information--line-item--textarea"
                  id="{{ line_item_input_id }}"
                  form="{{ product_form_id }}"
                  name="{{ line_item_input_name }}"
                  rows="3"
                  placeholder="{{ text_placeholder }}"
                  form="{{ product_form_id }}"
                  {% if required %}
                    required
                  {% endif -%}
                ></textarea>
              {% when 'checkbox' %}
                <input
                  type="hidden"
                  form="{{ product_form_id }}"
                  name="{{ line_item_input_name }}"
                  value="{{ block.settings.checkbox_unchecked_value | escape }}"
                >
                <input
                  type="checkbox"
                  class="custom-checkbox"
                  form="{{ product_form_id }}"
                  name="{{ line_item_input_name }}"
                  value="{{ block.settings.checkbox_checked_value | escape }}"
                  id="{{ line_item_input_id }}"
                  {% if required %}
                    required
                  {% endif %}
                >
              {% when 'multiple' %}
                {%- assign custom_options = block.settings.multiple_options
                  | newline_to_br
                  | strip_newlines
                  | split: '<br />'
                -%}
                {% if block.settings.multiple_style == 'dropdown' %}
                  <div class="select">
                    <select
                      name="{{ line_item_input_name }}"
                      id="{{ line_item_input_id }}"
                      form="{{ product_form_id }}"
                    >
                      {% for option in custom_options %}
                        <option
                          value="{{ option | escape }}"
                          {% if forloop.first %}
                            selected
                          {% endif %}
                        >
                          {{ option | escape }}
                        </option>
                      {% endfor %}
                    </select>
                    <div class="select-arrow">{%- render 'svg-icons' with 'thb-select' -%}</div>
                  </div>
                {% else %}
                  {% for option in custom_options %}
                    <label class="label">
                      <input
                        type="radio"
                        form="{{ product_form_id }}"
                        name="{{ line_item_input_name }}"
                        value="{{ option | escape }}"
                      >
                      <span class="label__text-beside-input">{{ option | escape }}</span>
                    </label>
                  {% endfor %}
                {% endif %}
            {% endcase %}
          </fieldset>
        {%- endif -%}
      {%- when 'sku' -%}
        <div
          class="product-sku product--text {{ block.settings.sku_style }}"
          id="sku-{{ section.id }}"
          {{ block.shopify_attributes }}
        >
          {{ product.selected_or_first_available_variant.sku }}
        </div>
      {%- when 'product_link' -%}
        <a
          href="{{ product.url }}"
          title="{{ 'products.product.view_product_details' | t | escape }}"
          class="text-button view-product-details"
          {{ block.shopify_attributes }}
        >
          {{- 'products.product.view_product_details' | t -}}
        </a>
    {%- endcase -%}
  {% endfor %}
</div>
{%- if section.settings.enable_sticky_add_to_cart -%}
  {% render 'product-add-to-cart-sticky',
    product: product,
    media: first_image,
    color_picker: color_picker,
    picker_type: picker_type,
    form: form,
    is_disabled: is_disabled
  %}
{%- endif -%}
{{ sizing_popup }}

<style>
    /* Add your styles for the pop-up and other elements here */
  @media only screen and (min-width: 750px) {
  .popup {
      display: none;
      position: absolute;
      top: 40%;
      left: 50%;
      z-index:999;
      width:100%;
      height:auto;
      transform: translate(-50%, -50%);
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  }
  }
   .cbb-frequent-product{
    display:flex;
    gap:10px;
  }
  .cbb-frequently-bought img{
    height:210px;
  }
  .cross-icon{
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
  }
  .variant_as-product{
    display:flex;
    align-items:center;
    margin-top:1rem;
      gap:5px;
  }
  .related-products__container{
    cursor:pointer;
  }

  .variant-count{
    font-size: 14px;
    color: #b5bdb8;
  }

  /* Add any other styles as needed */

    .cbb-frequent-item{
       flex-shrink: 0;
    }
  .cbb-frequent-product{
    overflow: auto;
    width: 100%;
    display: flex;
    align-items: center;
    column-gap: 10px;
  }
  .cbb-frequent-product::-webkit-scrollbar {
    display:none;
  }
 
  

  @media only screen and (max-width: 769px) {
      .popup {
      bottom:0;
      transform: translateX(-50%) translateY(0);
      width:100%;
       height:auto;
      display: none;
      position: fixed;
      z-index:9999;
      left: 50%;
      transform: translateX(-50%);
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
      let relatedProductsContainer = document.querySelector('.related-products__container');
      relatedProductsContainer.addEventListener('click', function () {
          openPopup();
      });
  });
  function openPopup() {
      let popup = document.getElementById('customPopup');
      popup.style.display = 'block';
  }
  function closePopup() {
      let popup = document.getElementById('customPopup');
      popup.style.display = 'none';
  }
</script>
